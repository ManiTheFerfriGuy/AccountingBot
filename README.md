# AccountingBot cPanel Deployment Guide

The instructions below explain every step required to deploy and operate AccountingBot on a cPanel host. Read the entire guide once before you start so you know what information you will need (for example, SSH credentials and the bot token).

---

## 0. Prerequisites and terminology

Before continuing, confirm that your hosting plan includes **SSH access** and the cPanel **Setup Python App** (a.k.a. Application Manager) feature. If anything is missing, contact your hosting provider and ask them to enable it.

You will need:

* A cPanel username and password or access token.
* The fully qualified domain name of your cPanel server (for example, `server.example.com`).
* A Telegram bot token generated by [@BotFather](https://t.me/BotFather).

In the commands below:

* `accountingbot` refers to the **Application root** you will create. Feel free to pick a different folder name, but keep it consistent.
* `/home/username/virtualenv/accountingbot/3.10/bin/python` is a sample virtual environment path. Replace `username`, the folder name, and the Python version with the values shown in the cPanel UI.

---

## 1. Create the Python application

1. Sign in to cPanel and open **Setup Python App**.
2. Click **Create Application** and choose the following settings:
   * **Python version:** `Python 3.10` or a newer version offered by your host. AccountingBot requires Python 3.10+.
   * **Application root:** `accountingbot` (or another empty directory under your home folder). cPanel creates the directory if it does not exist.
   * **Application URL:** leave empty because this project is a background bot, not a website.
   * **Startup file / WSGI file** and **Application startup command:** leave both blank for now—we will configure them later.
3. Click **Create**. cPanel provisions a virtual environment and shows several paths on the resulting page. Copy or note the **Virtual environment** path because you will activate it in later steps.

If you need to change the Python version or root directory later, you can revisit this screen and click **Edit** on the application.

---

## 2. Upload the project files

Move the AccountingBot source code into the Application root created above. Choose one of the following approaches:

* **Git (recommended):**
  1. Open the **Terminal** icon in cPanel or connect over SSH.
  2. Navigate to the application root and clone the repository:
     ```bash
     cd ~/accountingbot               # adjust to your chosen Application root
     rm -rf -- * .* 2>/dev/null || true
     git clone https://github.com/your-org/AccountingBot.git .
     ```
     The `rm -rf` command ensures the directory is empty before cloning. Remove it if this is a brand-new folder.
* **Upload a ZIP:**
  1. Download the project ZIP from GitHub.
  2. Open **File Manager**, navigate to the Application root, click **Upload**, and select the ZIP.
  3. After the upload finishes, use **Extract** to unpack the contents. Delete the ZIP when you are done to save space.
* **SFTP/FTP:** Upload the repository contents from your local machine into the Application root. Make sure the top-level files such as `README.md`, `requirements.txt`, and the `accountingbot/` package end up directly inside that directory.

Regardless of the method, verify that the `requirements.txt` file and the `accountingbot` package are present by running `ls` in the Application root.

---

## 3. Install Python dependencies

AccountingBot relies on the virtual environment cPanel created when you set up the application. Activate it and install the dependencies:

```bash
source /home/username/virtualenv/accountingbot/3.10/bin/activate  # replace with your actual path
pip install --upgrade pip
pip install -r requirements.txt
```

Tips:

* If you see a `command not found` error, re-check the path printed in the cPanel **Virtual environment** field. You must run `source` every time you open a new shell session before managing packages.
* After installations, keep the virtual environment active while performing administrative tasks such as database migrations or manual script runs.

---

## 4. Configure environment variables

The bot reads configuration from a `.env` file located in the Application root. Create or edit it with the following template:

```bash
cat > .env <<'ENV'
BOT_TOKEN=replace-with-your-telegram-token
DATABASE_PATH=accounting.db
LOG_FILE=accounting_bot.log
CPANEL_HOST=
CPANEL_USERNAME=
CPANEL_API_TOKEN=
CPANEL_VERIFY_SSL=true
ENV
```

Explanation of the keys:

* `BOT_TOKEN` (**required**): paste the token provided by @BotFather. Without it the bot cannot connect to Telegram.
* `DATABASE_PATH`: defaults to `accounting.db`, stored in the Application root. You can point it to an absolute path if you prefer a different location.
* `LOG_FILE`: file that stores runtime logs. Ensure the cPanel user has write permissions to the chosen path.
* `CPANEL_HOST`, `CPANEL_USERNAME`, `CPANEL_API_TOKEN`: optional credentials that enable the helper utilities inside `accountingbot/cpanel.py` for UAPI automation. Leave them blank if you do not plan to call those endpoints.
* `CPANEL_VERIFY_SSL`: set to `true` to require TLS verification when calling the cPanel API. Set `false` only if your host uses a self-signed certificate.

Security reminders:

* Do **not** commit `.env` to version control.
* Limit the permissions of the cPanel API token to the minimal scope required by your automation tasks.

---

## 5. Create the startup script and command

The cPanel Python application expects a startup file that launches your process. Configure AccountingBot to run via a small helper script:

1. Return to **Setup Python App** and click **Edit** next to your application. Leave the page open—you will paste values shortly.
2. Create a file named `start.py` in the Application root with the contents below. You can use the Terminal (`nano start.py`) or upload the file via SFTP.
   ```python
   import subprocess
   import sys
   from pathlib import Path

   from dotenv import load_dotenv

   BASE_DIR = Path(__file__).resolve().parent
   load_dotenv(BASE_DIR / ".env")

   if __name__ == "__main__":
       subprocess.run([sys.executable, "-m", "accountingbot.bot"], check=True)
   ```
   The script loads the `.env` file and executes the bot module using the same interpreter Passenger uses.
3. Back in the cPanel **Edit Application** screen:
   * Set **Startup file** to `start.py`.
   * Set **Application startup command** to the interpreter path printed in the **Virtual environment** section, followed by `start.py`. For example:
     ```
     /home/username/virtualenv/accountingbot/3.10/bin/python start.py
     ```
4. Click **Save** and then **Restart**. Passenger will now execute the command whenever the application restarts (after code changes, dependency updates, or manual restarts).

---

## 6. Manage and monitor the bot

Regular operations are performed through cPanel or SSH:

* **Restarting after changes:** In **Setup Python App**, press **Restart** any time you update code or configuration files.
* **Viewing logs:** Click **View Logs** in the application card to see Passenger output. For the bot-specific logs, inspect the file defined by `LOG_FILE` (default `~/accountingbot/accounting_bot.log`). Tail it with `tail -f accounting_bot.log` while the virtual environment is active to observe real-time events.
* **Updating code:** If you cloned via Git, run `git pull` inside the Application root, reinstall dependencies when `requirements.txt` changes, and restart the application. When using ZIP uploads, repeat the extraction process and overwrite the existing files.
* **Backing up data:** The SQLite database lives at the path specified by `DATABASE_PATH`. Download it via SFTP for backups or run `sqlite3 accounting.db` from SSH (while the virtual environment is activated) to inspect data.
* **Cron or manual scripts:** Activate the same virtual environment before running management commands so the correct dependencies and environment variables are available.

---

## 7. Optional cPanel automation

With the `CPANEL_HOST`, `CPANEL_USERNAME`, and `CPANEL_API_TOKEN` variables configured, you can invoke helpers in `accountingbot/cpanel.py` to call cPanel UAPI endpoints (for example, to manage email accounts or databases). Treat the API token like a password—store it securely and revoke it if compromised.

---

## 8. Troubleshooting tips

* **Bot does not respond:** Confirm the application is running (use **View Logs** and ensure no startup errors) and verify that `BOT_TOKEN` is correct. Regenerate the token in @BotFather if in doubt.
* **Import errors:** Re-run the dependency installation commands inside the activated virtual environment. Check that `pip` installs packages into the same environment that Passenger uses.
* **Permission issues writing logs or databases:** Ensure the paths used for `LOG_FILE` and `DATABASE_PATH` are inside your home directory or otherwise writable by the cPanel user.
* **SSL errors when calling Telegram or cPanel:** Verify that the server has outbound HTTPS access. For self-signed cPanel certificates, set `CPANEL_VERIFY_SSL=false` temporarily while you install a trusted certificate.

---

Need to revisit configuration later? Re-open **Setup Python App** at any time to review the settings, restart the process, or adjust the Python version. For Telegram-specific problems (webhook bans, rate limits, etc.), check the official [Telegram Bot API FAQ](https://core.telegram.org/bots/faq) once you have confirmed the application is running.
